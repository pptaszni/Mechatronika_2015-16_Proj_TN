Zaktualizwana wersja kodu, jeszcze musimy go uporządkować,
zmienić kilka rzeczy, pozbyć się zagnieżdzonych funkcji.